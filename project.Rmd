---
title: "Spotify Audio Analysis"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
---


```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(viridis)
library(rlang)
library(flexdashboard)
library(dplyr)
```

```{r, echo = FALSE}
songs = read_rds("songs.csv")
genres = read_rds("genres.csv")
artists = read_rds("artists.csv")

songs2 <- 
  songs |>
  mutate(duration_m = duration_ms/60000)
```

Audio Features part 1
==========================

The first question we chose to look at is how the various audio features differ by genre. The left plot analyzes these features over time and the right plot measures the frequency of each feature by genre.

Row
-------------------------

```{r, echo=FALSE}
inputPanel(
 selectInput("y", label = "y-axis variable:",
    choices = c("Danceability" = "danceability",
                "Energy" = "energy",
                "Loudness" = "loudness",
                "Speechiness" = "speechiness", 
                "Acousticness" = "acousticness", 
                "Instrumentalness" = "instrumentalness",
                "Liveness" = "liveness",
                "Valence" = "valence",
                "Tempo" = "tempo")),
 selectInput("genre", label = "Genre 1:", 
             choices = c("R&B" = "R&B",
                         "Christian" = "christian",
                         "Country" = "country",
                         "EDM" = "edm",
                         "Hip-Hop" = "hip-hop",
                         "Indie" = "indie",
                         "Latin" = "latin",
                         "Pop" = "pop",
                         "Rap" = "rap",
                         "Rock" = "rock")),
 selectInput("genre0", label = "Genre 2:", 
             choices = c("R&B" = "R&B",
                         "Christian" = "christian",
                         "Country" = "country",
                         "EDM" = "edm",
                         "Hip-Hop" = "hip-hop",
                         "Indie" = "indie",
                         "Latin" = "latin",
                         "Pop" = "pop",
                         "Rap" = "rap",
                         "Rock" = "rock"))
)

inputPanel(
  selectInput("x2", label = "x-axis variable:",
    choices = c("Danceability" = "danceability",
                "Energy" = "energy",
                "Loudness" = "loudness",
                "Speechiness" = "speechiness", 
                "Acousticness" = "acousticness", 
                "Instrumentalness" = "instrumentalness",
                "Liveness" = "liveness",
                "Valence" = "valence",
                "Tempo" = "tempo")),
 selectInput("genre2", label = "Genre 1:", 
             choices = c("R&B" = "R&B",
                         "Christian" = "christian",
                         "Country" = "country",
                         "EDM" = "edm",
                         "Hip-Hop" = "hip-hop",
                         "Indie" = "indie",
                         "Latin" = "latin",
                         "Pop" = "pop",
                         "Rap" = "rap",
                         "Rock" = "rock")),
 selectInput("genre02", label = "Genre 2:", 
             choices = c("R&B" = "R&B",
                         "Christian" = "christian",
                         "Country" = "country",
                         "EDM" = "edm",
                         "Hip-Hop" = "hip-hop",
                         "Indie" = "indie",
                         "Latin" = "latin",
                         "Pop" = "pop",
                         "Rap" = "rap",
                         "Rock" = "rock"))
)
```

Row
-------------------------

```{r, echo = FALSE}
renderPlot({
  filtered_songs <- songs %>%
    filter(genre %in% c(input$genre, input$genre0))
  
  ggplot(filtered_songs, aes(y = .data[[input$y]], x = album_release_year, color = genre)) + 
    geom_point() + 
    geom_smooth(method = "lm", se = F) + labs(x = "Album Release Year", color = "Genre") + theme_classic() + scale_color_calc()
})

renderPlot({
  filtered_songs <- songs %>%
    filter(genre %in% c(input$genre2, input$genre02))
  
  ggplot(filtered_songs, aes(x = .data[[input$x2]], fill = genre)) + 
    geom_density(alpha = 0.5) + labs(fill = "Genre") + theme_classic() + scale_fill_calc()
})
```

Row
-------------------------

With these plots, the viewer is able to observe many differences and similarities between the genres and the audio features. Some observations we made are that:

- 

Audio Features part 2
==========================

Inputs {.sidebar}
-------------------------

```{r, echo=FALSE}
inputPanel(
  checkboxGroupInput("genre_check", "Select Genres:",
                     choices = c("All", 
                              unique(as.character(songs$genre))),                         selected = "All"),
  selectInput("x5", label = "x-axis variable:",
    choices = c("Popularity" = "popularity",
                "Followers" = "followers.total")),
 selectInput("y5", label = "y-axis variable:",
    choices = c("Danceability" = "danceability",
                "Energy" = "energy",
                "Loudness" = "loudness",
                "Speechiness" = "speechiness", 
                "Acousticness" = "acousticness", 
                "Instrumentalness" = "instrumentalness",
                "Liveness" = "liveness",
                "Valence" = "valence",
                "Tempo" = "tempo"))
)

```

Row
-------------------------------------

Our second question was how do the various audio features differ for each genre based on each of the top artist's total followers and popularity score out of 100.

Row
-------------------------------------

```{r, echo = FALSE}
genre3 <- reactive({
  if("All" %in% input$genre_check) {
    filtered_songs <- songs
  } else {
    filtered_songs <- songs %>%
      filter(genre %in% input$genre_check)
  }
  filtered_songs
})

renderPlot({
  ggplot(genre3(), aes(x = .data[[input$x5]], y = .data[[input$y5]], color = genre)) +
    geom_point(position = position_jitterdodge()) + labs(color = "Genre") + theme_classic() + scale_color_calc()
})
```

Row
-------------------------------------

The ability to select any amount of the 10 genres gives viewers the freedom to explore differences in audio features based on either each artists popularity score and each artist's total followers. 

Some trends we observed are:
- 

Artist Trends
==========================

The third question we chose to look at was how the number of songs per album differs for the top artists within each genre. The left plot analyzes the number of songs per album over time and the right plot looks at how the amount of songs per album differs based on the artists popularity score out of 100.

```{r, echo = FALSE}
inputPanel(
 selectInput("genre3", label = "Genre:", 
             choices = c("R&B" = "R&B",
                         "Christian" = "christian",
                         "Country" = "country",
                         "EDM" = "edm",
                         "Hip-Hop" = "hip-hop",
                         "Indie" = "indie",
                         "Latin" = "latin",
                         "Pop" = "pop",
                         "Rap" = "rap",
                         "Rock" = "rock"))
)
```

Row
-------------------------

```{r, echo = FALSE}
renderPlot({
  songs2 |>
    filter(genre == input$genre3) |>
    group_by(album_name) |>
  mutate(num_songsalbum = n()) |>
  ggplot(aes(y = num_songsalbum, x = album_release_year, color = name)) + 
    geom_point() + geom_smooth(method = "lm", se = FALSE) + labs(x = "Album Release Year", color = "Artist Name", y = "Number of Songs per Album")+ theme_classic() + scale_color_calc()
})
```

```{r, echo = FALSE}
renderPlot({
  filtered_songs <- songs %>%
    filter(genre == input$genre3) |>
   group_by(album_name) |>
  mutate(num_songsalbum = n()) 
  
  ggplot(filtered_songs, aes(x = popularity, y = num_songsalbum, color = name)) + 
    geom_boxplot() + labs(x = "Popularity", y = "Number of Songs per Album", color = "Artist Name") + theme_classic() + scale_color_calc()
})
```

Concluding Thoughts
==========================

Although we outlined a few questions, our shiny app gives viewers the flexibility to look at many different questions regarding Spotify artists and their audio features. We hope that viewers may be able to learn more about their favorite genre and be able to find similarities and differences between their favorite and least favorite genres.


**Tribulations and Victories of Data Acquisition and Wrangling:**

After acquiring a Spotify ID and access token, we were able to view all Spotify data on an artist or song by using either it's name or it's unique ID. Originally, we had wanted to analyze at least five artists per genre in order to build a larger dataset and have more accurate analysis. However, our for loop was inconsistent with the large amount of data and had a difficult time finding the correct artists based of off their ID. Each time we ran the for loop, we would receive a dataset with a different number of artists. Due to this, we ended up reducing our sample size and looking at between three and five artists per genre. This was a significantly smaller number and allowed the for loop to work accurately, which enabled us to produce our final dataset. 

by Belle Schmidt and Abby Hahs
